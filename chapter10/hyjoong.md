# 10장: 리액트 17과 18의 변경 사항 살펴보기

<br>

- [10장: 리액트 17과 18의 변경 사항 살펴보기](#10장-리액트-17과-18의-변경-사항-살펴보기)
  - [10.1 리액트 17 버전 살펴보기](#101-리액트-17-버전-살펴보기)
  - [10.2 리액트 18 버전 살펴보기](#102-리액트-18-버전-살펴보기)

<br>

## 10.1 리액트 17 버전 살펴보기

### 10.1.1 리액트의 점진적인 업그레이드

리액트 17부터 점진적인 업그레이드가 가능하다. 리액트 17에서 18으로 업데이트 할 때 리액트 18에서 제공하는 대부분의 기능을 사용할 수도 있지만 일부 기능에 대해서는 리액트17에 머물러 있는 것이 가능하다.

#### 10.1.2 이벤트 위임 방식의 변경

에빈트 위임이 리액트 16버전까지는 모두 document에서 수행되고 있었다. 그런데 리액트 17부터는 이러한 이벤트 위임이 모두 document가 아닌 리액트 컴포넌트 최상단 트리, 즉 루트 요소로 바뀌었다.

#### 10.1.3 import React from ‘react’가 더 이상 필요 없다: 새로운 JSX transform

JSX는 브라우저가 이해할 수 있는 코드가 아니므로 바벨이나 타입스크립트를 활용해 JSX를 실행하기 위해 일반적인 자바스크립트로 변환하는 과정이 꼭 필요하다. 16버전까지는 이러한 JSX 변환을 사용하기 위해 코드 내에서 React를 사용하는 구문이 없더라도 import React from 'react'가 필요했고, 이 코드가 없다면 에러가 발생했다.
그러나 리액트 17부터 바벨과 협력해 이러한 import 구문 없이도 JSX를 변환할 수 있게 됐다. 이 새로운 변환식은 'import React'가 필요 없다는 장점 외에도 불필요한 import 구문을 삭제해 `번들링 크기를 약간 줄일 수 있고`, 컴포넌트 작성을 더욱 간결하게 해준다.

#### 10.1.4 그 밖의 주요 변경 사항

#### 이벤트 풀링 제거

#### useEffect 클린업 함수의 비동기 실행

useEffect에 있는 클린업 함수는 리액트 16버전까지는 동기적으로 처리됐다. 동기적으로 실행되기 때문에 이 클린업 함수가 완료되기 전까지는 다른 작업을 방해하는 불필요한 성능 저하로 이어지는 문제가 존재했다.
그러나 리액트 17 버전부터는 화면이 완전히 업데이트된 이후에 클린업 함수가 비동기적으로 실행된다. 조금 더 정확히 이야기하자면 클린업 함수는 컴포넌트의 커밋 단계가 완료될 때까지 지연된다. 즉 화면의 업데이트가 완전히 끝난 이후에 실행되도록 바뀌어서, 약간의 성능적인 이점을 볼 수 있게 됐다.

#### 컴포넌트의 undefined 반환에 대한 일관적인 처리

<br>

## 10.2 리액트 18 버전 살펴보기

#### 10.2.1 새로 추가된 훅 살펴보기

리액트 18에서는 리액트 16.8에서 처음 선보였던 이래로 새로운 훅을 대거 추가했다.

#### useId

컴포넌트별로 유니크한 값을 생성하는 새로운 훅

#### useTransition

UI변경을 가로막지 않고 상태를 업데이트할 수 있는 리액트 훅
상태 업데이트를 긴급하지 않은 것으로 간주해 무거운 렌더링 작업을 조금 미룰 수 있으며, 사용자에게 조금 더 나은 사용자 경험을 제공할 수 있다.
useTransition은 리액트 18의 변경 사항의 핵심 중 하나인 동시성(cuncurrency)을 다를 수 있는 새로운 훅이다. 동시성을 지원하는 기능을 사용하면 느린 렌더링 과정에서 로딩 화면을 보여주거나 혹은 지금 진행 중인 렌더링을 버리고 새로운 상태값으로 다시 렌더링하는 등의 작업을 할 수 있게 된다.

#### useDeferredValue

리액트 컴포넌트 트리에서 리렌더링이 급하지 않은 부분을 지연할 수 있게 도와주는 훅이다.

#### useInsertionEffect

CSS-in-js 라이브러리를 위한 훅이다.
리액트 17과 styled-components에서는 클라이언트 렌더링 시에 서버 사이드에서 스타일 코드를 삽입했다. 훅에서 이러한 작업을 도와주는 새로운 훅이다

#### 10.2.2 react-dom/client

클라이언트에서 리액트 트리를 만들 때 사용되는 API가 변경됐다.

#### createRoot

기존의 react-dom에 있던 render 메서드를 대체할 새로운 메서드다.리액트 18의 기능을 사용하고 싶다면 이 createRoot와 render를 함쎄 사용해야 한다.

#### hydrateRoot

서버사이드 렌더링 애플리케이션에서 하이드레이션을 하기 위한 새로운 메서드다.

#### 10.2.3 react-dom/server

#### renderToPipeableStream

리액트 컴포넌트를 HTML로 렌더링하는 메서드다. stream을 지원하는 메서드로, HTML을 점진적으로 렌더링하고 클라이언트에서는 중간에 script를 삽입하는 등의 작업을 할 수 있다. 이를 통해 서버에서는 Suspense를 사용해 빠르게 렌더링이 필요한 부분을 먼저 렌더링할 수 있고, 값비싼 연산으로 구성된 부분은 이후에 렌더링되게끔 할 수 있다.

#### renderToReadableStream

웹 스트림을 기반으로 작동한다.

#### 10.2.4 자동 배치(Automatic Batching)

리액트가 여러 상태 업데이트를 하나의 리렌더링으로 묶어서 성능을 향상시키는 방법을 의미한다. 예를 들어, 버튼 클릭 한 번에 두 개 이상의 state를 동시에 업데이트한다고 가정할 때 리액트17에서는 자동 배치가 되지 않아 두 번의 리렌더링이 일어났지만 리액트 18에서는 자동 배치 덕분에 리렌더링이 단 한 번만 일어났다.

### 10.2.5 더욱 엄격해진 엄격 모드

엄격 모드에서 수행하는 모드는 모두 개발자 모드에서만 작동하고, 프로덕션 모드에서는 작동하지 않는다. 컴포넌트 형태로 사용할 수 있으므로 이 예제처럼 모든 리액트 애플리케이션 전체에서 작동하게 할 수도, 원한다면 특정 컴포넌트 내부에서만 작동하게 할 수도 있다.

리액트 엄격 모드에서 하는 작업은 아래와 같다.

#### 1. 더 이상 안전하지 않은 특정 생명주기를 사용하는 컴포넌트에 대한 경고

리액트 클래스형 컴포넌트에서 사용되는 생명주기 메서드의 일부를 사용할 수 없게 됐다.

#### 2. 문자열 ref 사용 금지

과거에는 문자열로 ref를 생성하고, 이를 사용해 DOM노드를 참조하는 것이 가능했다.

```javascript
<input type='text' ref='myInput' />
```

하지만 문자열로 값을 주는 것은 여러 컴포넌트에 걸쳐 사용될 수 있으므로 충돌여지가 있으므로 경고 문고가 나타난다.

#### 3. findDOMNode에 대한 경고 출력

클래스형 컴포넌트 인스턴스에서 실제 DOM요소에 대한 참조를 가져올 수 있는, 현재는 사용하는 것이 권장되지 않는 메서드다.

#### 4. 구 Context API 사용 시 발생하는 경고

childContextTypes와 getChildContext를 사용하는 구 리액트 Context API를 사용하면 엄격 모드에서는 다음과 같은 에러를 출력한다.

### 10.2.6 Suspense 기능 강화

Suspense는 리액트 16.6 버전에서 실험 버전으로 도입된 기능으로, 컴포넌트를 동적으로 가져올 수 있게 도와주는 기능이다.

리액트 18 이전의 Suspense에는 몇 가지 문제점이 있었다.

- 기존의 Suspense는 컴포넌트가 아직 보이기도 전에 useEffect가 실행되는 문제가 존재했다.
- Suspense는 서버에서 사용할 수 없었다.

리액트 18 버전에서는 Suspense가 실험 단계를 벗어나 정식으로 지원된다. 변경된 내용은 다음과 같다.

- 앞에서 언급했던, 아직 마운트되기 직전임에도 effect가 빠르게 실행되는 문제가 수정됐다.
- Suspense를 이제 서버에서도 실행할 수 있게 된다.
- Suspense 내에 스로틀링이 추가됐다. 화면이 자주 업데이트되어 시각적으로 방해받는 것을 방지하기 위해 리액트는 다음 렌더링을 보여주기 전에 잠시 대기한다.

### 10.2.7 인터넷 익스플로러 지원 중단에 따른 추가 폴리필 필요

이제 리액트는 리액트를 사용하는 코드에서 다음과 같은 최신 자바스크립트 기능을 사용할 수 있다는 가정하에 배포된다.

- Promise
- Symbol
- Object

### 10.2.8 그 밖에 알아두면 좋은 변경사항

- 이제 컴포넌트에서 undefined를 반환해도 에러가 발생하지 않는다.(null 반환과 동일하게 처리)
- 이와 마찬가지로 <Suspense fallback={undefined}>도 null과 동일하게 처리된다/
- renderToNodeStream이 지원 중단됐다. 그 대신 renderToPipeableStream을 사용하는 것이 권장된다
