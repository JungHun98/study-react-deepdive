# 11장: Next.js 13과 리액트 18

이 장은 Next.js 13과 리액트 18의 새로운 기능을 소개합니다.

<br>

- [11장: Next.js 13과 리액트 18](#11장-nextjs-13과-리액트-18)
  - [11.1 `app` 디렉터리의 등장](#111-app-디렉터리의-등장)
    - [11.1.1 라우팅](#1111-라우팅)
  - [11.2 리액트 서버 컴포넌트](#112-리액트-서버-컴포넌트)
    - [11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계](#1121-기존-리액트-컴포넌트와-서버-사이드-렌더링의-한계)
    - [11.2.2 서버 컴포넌트란?](#1122-서버-컴포넌트란)
    - [11.2.3 서버 사이드 렌더링과 서버 컴포넌트의 차이](#1123-서버-사이드-렌더링과-서버-컴포넌트의-차이)
    - [11.2.4 서버 컴포넌트는 어떻게 작동하는가?](#1124-서버-컴포넌트는-어떻게-작동하는가)
  - [11.3 `Next.js`에서의 리액트 서버 컴포넌트](#113-nextjs에서의-리액트-서버-컴포넌트)
    - [11.3.1 새로운 `fetch` 도입과 `getServerSideProps`, `getStaticProps`, `getInitial Props`의 삭제](#1131-새로운-fetch-도입과-getserversideprops-getstaticprops-getinitial-props의-삭제)
    - [11.3.2 정적 렌더링과 동적 렌더링](#1132-정적-렌더링과-동적-렌더링)
    - [11.3.3 캐시와 `mutating`, 그리고 `revalidating`](#1133-캐시와-mutating-그리고-revalidating)
    - [11.3.4 스트리밍을 활용한 점진적인 페이지 불러오기](#1134-스트리밍을-활용한-점진적인-페이지-불러오기)
  - [11.4 웹팩의 대항마, 터보팩의 등장(`beta`)](#114-웹팩의-대항마-터보팩의-등장beta)
  - [11.5 서버 액션(`alpha`)](#115-서버-액션alpha)
    - [11.5.1 `form`의 `action`](#1151-form의-action)
    - [11.5.2 `input`의 `submit`과 `image`의 `formAction`](#1152-input의-submit과-image의-formaction)
    - [11.5.3 `startTransition`과의 연동](#1153-starttransition과의-연동)
    - [11.5.4 `server mutation`이 없는 작업](#1154-server-mutation이-없는-작업)
    - [11.5.5 서버 액션 사용 시 주의할 점](#1155-서버-액션-사용-시-주의할-점)
  - [11.6 그 밖의 변화](#116-그-밖의-변화)
  - [11.7 `Next.js 13` 코드 맛보기](#117-nextjs-13-코드-맛보기)
    - [11.7.1 `getServerSideProps`와 비슷한 서버 사이드 렌더링 구현해 보기](#1171-getserversideprops와-비슷한-서버-사이드-렌더링-구현해-보기)
    - [11.7.2 `getStaticProps`와 비슷한 정적인 페이지 렌더링 구현해 보기](#1172-getstaticprops와-비슷한-정적인-페이지-렌더링-구현해-보기)
    - [11.7.3 로딩, 스트리밍, 서스펜스](#1173-로딩-스트리밍-서스펜스)
  - [11.8 정리 및 주의사항](#118-정리-및-주의사항)

<br>


**[Next.js 13과 이전 버전과의 차이점]**

| 기능                   | **Next.js 12**                                                                 | **Next.js 13**                                                                                      |
|----------------------|---------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| **라우팅**                   | 기본 파일 시스템 기반 라우팅 제공. 페이지와 API 경로는 `pages` 디렉토리에 정의.       | `app` 디렉토리를 도입하여 더 선언적이고 직관적인 라우팅 구조 제공. 페이지와 API 경로를 `app` 디렉토리 내에서 관리. |
| **서버 컴포넌트**               | 지원하지 않음.                                                              | `React Server Components`를 도입하여 서버에서만 실행되는 컴포넌트 지원, 클라이언트 사이드 번들 크기 감소 가능.       |
| **코드 분할**                 | 자동 코드 분할 및 페이지 단위의 레이지 로딩 지원.                                        | 코드 분할 기능이 개선되어 더욱 효율적인 로딩과 성능 최적화 제공.                                      |
| **스타일링 옵션**               | `CSS` 및 `SASS` 지원, `CSS 모듈`, `CSS-in-JS` 라이브러리와의 통합 등 다양한 스타일링 옵션 제공. | `@next/css` 모듈을 통해 CSS 파일 자동 분할 및 최적화, 스타일링 성능 향상.                            |
| **이미지 최적화**               | `next/image`를 통한 이미지 최적화 기능 제공. 포맷 변환, 로딩 지연 등의 기능 포함.          | 이미지 최적화 기능이 더욱 강화되어 성능과 호환성 향상, 추가적인 이미지 포맷 지원.                      |
| **성능 최적화**                | 자동 정적 최적화, 번들 분석기 등을 포함한 성능 최적화 기능 제공.                           | 더 나은 성능을 위한 새로운 기능 및 개선 사항 추가. 페이지 로딩 시간과 TTFB(Time to First Byte) 개선에 중점.   |
| **개발 경험**                 | Fast Refresh, 모듈 핫 리로딩(MHR) 등을 통한 빠른 개발 경험 제공.                           | 개발 경험이 더욱 개선되어 빠른 피드백과 반복 가능. 개발자 도구와의 통합 강화.                           |
| **데이터 페칭**                | `getStaticProps`, `getServerSideProps`, `getInitialProps` 등을 통한 데이터 페칭 방법 제공.  | 데이터 페칭 방법에 대한 개선 및 새로운 패턴 제공, 서버 컴포넌트와의 통합으로 데이터 의존성 관리 간소화.        |

> 위 표는 Next.js 13의 주요 변경 사항과 이전 버전들과의 차이점 비교하고자 간략하게 작성한 것입니다.


## 11.1 `app` 디렉터리의 등장

![descope, Pages router and app](https://www.descope.com/_next/image?url=https%3A%2F%2Fimages.ctfassets.net%2Fxqb1f63q68s1%2F5iRYZzriBUGyCvpXB62C2v%2F6055d11d75cb84a8ba6b7bc33c355556%2Fpage_and_app_route_next_blog.png&w=3840&q=75)

**Next.js 12 버전 이전**
- `_document.js`:
  - 서버에서만 실행되기 때문에, 클라이언트 측 이벤트 핸들러를 추가하거나 클라이언트 로직을 포함하는 것이 불가능합니다.
  - `<html>`, `<body>` 태그를 수정하거나, 서버 사이드 렌더링 시 `CSS-in-JS` 라이브러리 (예: `styled-components`)를 사용하기 위한 설정을 할 수 있습니다.
- `_app.js`:
  - 모든 페이지에 공통으로 적용되는 초기화 컴포넌트입니다.
  - 페이지 전환 시 유지되어야 하는 레이아웃을 정의할 수 있습니다.
  - 페이지 전환 시 상태를 유지할 수 있습니다.
  - `componentDidCatch` 메소드를 사용한 에러 핸들링을 할 수 있습니다.
  - 모든 페이지에 추가 데이터를 삽입할 수 있습니다.
  - 전역 `CSS`를 주입할 수 있습니다.

**Next.js 13 버전 부터**
- `app/` 디렉토리:
  - 새롭게 도입된 `app/` 디렉토리를 통해 더 유연한 라우팅과 애플리케이션 구조를 제공합니다.
  - 개별 페이지와 통합된 레이아웃을 정의하여, 페이지 전환 시 레이아웃을 유지하거나 변경할 수 있습니다.
  - 데이터 페칭 방식이 향상되었으며, `getServerSideProps`와 `getStaticProps`를 대체하는 새로운 데이터 페칭 메소드를 제공합니다.
  - 페이지 로딩 상태 관리와 에러 핸들링이 개선되었습니다.


| 기능                | **Next.js 12**        | **Next.js 13**        |
|---------------------|-------------------|-------------------|
| **컴포넌트의 반환 타입** | `AppProps`는 `JSX` 요소를 반환합니다. | `children`은 `ReactNode` 타입입니다. `ReactNode`는 `JSX` 요소, 숫자, 문자열, 불리언, 배열을 포함한 "더 큰" 타입입니다. |
| **Props 전달 방식**      | `Props`는 컴포넌트에 직접 전달됩니다. | `Props`는 컴포넌트에 직접 전달됩니다. |
| **노드 표시 방식**       | 단순히 노드를 표시합니다. 레이아웃은 공유 UI입니다. | 단순히 노드를 표시합니다. 레이아웃은 공유 UI입니다. |
| **컴포넌트 타입**        | `_app.tsx`는 클라이언트 컴포넌트입니다. | `layout.tsx`는 서버 컴포넌트입니다. |


**[(참고) `Next.js 12` 버전 이전 - `/app`라우팅]**

`Next.js 12` 버전 이전에는 `/app` 경로를 라우팅하기 위해 `experimental` 속성을 사용해야 했습니다.
- `experimental` 설정은 `Next.js`의 실험적인 기능을 활성화하기 위한 설정입니다.

```jsx
/**
 * @type {import('next').NextConfig}
 * @typedef {import('next').NextConfig} NextConfig
 */

/** @type {NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  experimental: {
    appDir: true // `experimental` 설정을 사용하여 `appDir` 속성을 활성화하여 `/app` 경로를 사용할 수 있도록 했습니다.
  }
}

module.exports = nextConfig
```
> `Next.js 13.4.0` 이상에서는 `/pages` 디렉토리 내의 파일들이 기본적으로 라우팅되기 때문에 `/app` 경로를 처리하기 위해 별도의 설정이 필요하지 않습니다.


### 11.1.1 라우팅

<br>

## 11.2 리액트 서버 컴포넌트

### 11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계

### 11.2.2 서버 컴포넌트란?

### 11.2.3 서버 사이드 렌더링과 서버 컴포넌트의 차이

### 11.2.4 서버 컴포넌트는 어떻게 작동하는가?

<br>

## 11.3 `Next.js`에서의 리액트 서버 컴포넌트

### 11.3.1 새로운 `fetch` 도입과 `getServerSideProps`, `getStaticProps`, `getInitial Props`의 삭제

### 11.3.2 정적 렌더링과 동적 렌더링

### 11.3.3 캐시와 `mutating`, 그리고 `revalidating`

### 11.3.4 스트리밍을 활용한 점진적인 페이지 불러오기

<br>

## 11.4 웹팩의 대항마, 터보팩의 등장(`beta`)

<br>

## 11.5 서버 액션(`alpha`)

### 11.5.1 `form`의 `action`

### 11.5.2 `input`의 `submit`과 `image`의 `formAction`

### 11.5.3 `startTransition`과의 연동

### 11.5.4 `server mutation`이 없는 작업

### 11.5.5 서버 액션 사용 시 주의할 점

<br>

## 11.6 그 밖의 변화

<br>

## 11.7 `Next.js 13` 코드 맛보기

### 11.7.1 `getServerSideProps`와 비슷한 서버 사이드 렌더링 구현해 보기

### 11.7.2 `getStaticProps`와 비슷한 정적인 페이지 렌더링 구현해 보기

### 11.7.3 로딩, 스트리밍, 서스펜스

<br>

## 11.8 정리 및 주의사항
